# Prisma Cloud API Discovery

An example script that can be used to pull API Discovery data from Prisma Cloud.

Note: This is POV code. There are no guarantees that it will be maintained.

## Instructions

Set the `PRISMA_CLOUD_PATH_TO_CONSOLE` and `PRISMA_CLOUD_API_TOKEN` environment variables. These values can be found by navigating to: **Compute > Manage > System > Utilities**

## Example df output

```
        ruleID     appID                                              image                                            servers                  path method protectionStatus      hits                 firstSeen                  lastSeen  riskScore                 clientTypes               lastChanged  vulnCountCritical  vulnCountHigh  vulnCountMedium  vulnCountLow  vulnCountTotal  riskFactorAttackComplexityLow  riskFactorAttackVectorNetwork  riskFactorCriticalSeverity  riskFactorDosHigh  riskFactorDosLow  riskFactorExploitExistsPoc  riskFactorExploitExistsInTheWild  riskFactorHasFix  riskFactorHighSeverity  riskFactorMediumSeverity  riskFactorPackageInUse  riskFactorRecentVulnerability  riskFactorRemoteExecution  owaspAPIAttacks  responseSensitiveData  public  sensitiveData                                              host
0     testpvdh  app-08E9  123456789012.dkr.ecr.us-east-1.amazonaws.com/e...  [http://192.168.201.66:8080, http://192.168.25...               /health    GET        monitored  23483076   2023-04-09T23:52:02.65Z  2023-09-05T22:09:50.341Z         11                   [httpLib]  2023-09-01T16:09:50.086Z                  6             12                5             0              23                           True                           True                        True               True              True                        True                             False              True                    True                      True                   False                           True                       True            False                  False   False          False                                             False
1     testpvdh  app-08E9  gke.gcr.io/prometheus-engine/prometheus@sha256...  [http://10.8.0.7:19090, http://localhost:19090...              /-/ready    GET      unprotected   1506063  2023-08-02T14:53:45.556Z  2023-09-05T22:09:30.286Z          9                   [httpLib]  2023-08-21T13:52:26.922Z                  0              4                7             0              11                           True                           True                       False               True              True                       False                             False              True                    True                      True                   False                           True                       True             True                  False   False          False                                             False
2     testpvdh  app-08E9  gke.gcr.io/prometheus-engine/prometheus@sha256...  [http://10.8.0.7:19090, http://10.8.1.11:19090...            /-/healthy    GET      unprotected   1506056  2023-08-02T14:53:47.969Z  2023-09-05T22:09:30.284Z          9                       False  2023-08-21T13:52:20.777Z                  0              4                7             0              11                           True                           True                       False               True              True                       False                             False              True                    True                      True                   False                           True                       True             True                  False   False          False                                             False
3     testpvdh  app-08E9  gke.gcr.io/prometheus-engine/prometheus@sha256...  [http://10.8.0.7:19090, http://10.8.1.11:19090...              /metrics    GET        monitored    255204  2023-08-02T14:53:58.981Z  2023-09-05T22:08:55.891Z          9                       False  2023-08-05T23:22:55.067Z                  0              4                7             0              11                           True                           True                       False               True              True                       False                             False              True                    True                      True                   False                           True                       True            False                   True   False          False                                             False
4     testpvdh  app-08E9  gcr.io/google-samples/microservices-demo/front...            [http://frontend, http://12.34.56.78]                 /cart   POST        monitored    223909  2023-08-02T14:55:05.981Z  2023-09-05T22:06:26.338Z         10          [httpLib, browser]  2023-08-21T14:26:48.074Z                  3              2                6             0              11                           True                           True                        True               True              True                       False                             False              True                    True                      True                   False                           True                       True            False                   True   False          False                                             False
```

## Example dict output

```python
 {'appID': 'app-08E9',
  'firstSeen': '2023-06-13T02:09:50.519Z',
  'hits': 67902,
  'image': 'gke.gcr.io/prometheus-to-sd@sha256:654791db0d4d17c5847221fd3ace5c23ea1bb20c5976db9fda0853fd6000ab65',
  'lastChanged': '2023-08-31T07:56:40.803Z',
  'lastSeen': '2023-09-03T23:33:50.755Z',
  'method': 'GET',
  'path': '/readiness',
  'protectionStatus': 'monitored',
  'riskFactors': {'Attack complexity: low': {},
                  'Attack vector: network': {},
                  'Critical severity': {},
                  'DoS - High': {},
                  'DoS - Low': {},
                  'Has fix': {},
                  'High severity': {},
                  'Medium severity': {},
                  'Recent vulnerability': {},
                  'Remote execution': {}},
  'riskScore': 10,
  'ruleID': 'promethues-demo',
  'servers': ['http://10.232.2.2:8081',
              'http://10.24.2.2:8081',
              'http://10.8.0.142:8081'],
  'vulnerabilityDistribution': {'critical': 5,
                                'high': 30,
                                'low': 3,
                                'medium': 11,
                                'total': 49}},
 {'appID': 'app-08E9',
  'clientTypes': ['httpLib'],
  'firstSeen': '2023-08-02T14:53:45.556Z',
  'hits': 1422580,
  'image': 'gke.gcr.io/prometheus-engine/prometheus@sha256:439d8ea40b2ff84a0c269ee981acd8dc531e47f7da2fabf1d98c4bb55c6eee12',
  'lastChanged': '2023-08-21T13:52:26.922Z',
  'lastSeen': '2023-09-03T23:33:49.867Z',
  'method': 'GET',
  'owaspAPIAttacks': True,
  'path': '/-/ready',
  'protectionStatus': 'unprotected',
  'riskFactors': {'Attack complexity: low': {},
                  'Attack vector: network': {},
                  'DoS - High': {},
                  'DoS - Low': {},
                  'Has fix': {},
                  'High severity': {},
                  'Medium severity': {},
                  'Recent vulnerability': {},
                  'Remote execution': {}},
  'riskScore': 9,
  'ruleID': 'promethues-demo',
  'servers': ['http://10.8.0.7:19090',
              'http://localhost:19090',
              'http://10.8.1.11:19090',
              'http://10.8.1.71:19090',
              'http://10.8.0.199:19090',
              'http://10.8.1.136:19090',
              'http://10.8.0.143:19090',
              'http://172.22.98.2:19090'],
  'vulnerabilityDistribution': {'critical': 0,
                                'high': 4,
                                'low': 0,
                                'medium': 7,
                                'total': 11}},
 {'appID': 'app-08E9',
  'firstSeen': '2023-08-02T14:53:47.969Z',
  'hits': 1422573,
  'image': 'gke.gcr.io/prometheus-engine/prometheus@sha256:439d8ea40b2ff84a0c269ee981acd8dc531e47f7da2fabf1d98c4bb55c6eee12',
  'lastChanged': '2023-08-21T13:52:20.777Z',
  'lastSeen': '2023-09-03T23:33:49.866Z',
  'method': 'GET',
  'owaspAPIAttacks': True,
  'path': '/-/healthy',
  'protectionStatus': 'unprotected',
  'riskFactors': {'Attack complexity: low': {},
                  'Attack vector: network': {},
                  'DoS - High': {},
                  'DoS - Low': {},
                  'Has fix': {},
                  'High severity': {},
                  'Medium severity': {},
                  'Recent vulnerability': {},
                  'Remote execution': {}},
  'riskScore': 9,
  'ruleID': 'promethues-demo',
  'servers': ['http://10.8.0.7:19090',
              'http://10.8.1.11:19090',
              'http://10.8.1.71:19090',
              'http://10.8.0.199:19090',
              'http://10.8.1.136:19090',
              'http://10.8.0.143:19090',
              'http://172.22.98.2:19090'],
  'vulnerabilityDistribution': {'critical': 0,
                                'high': 4,
                                'low': 0,
                                'medium': 7,
                                'total': 11}},
 {'appID': 'app-08E9',
  'firstSeen': '2023-08-02T14:54:15.261Z',
  'hits': 216397,
  'image': 'gke.gcr.io/metrics-server@sha256:1d20492ca374191e5b6ff4b7712b62b41ab75ce226424974356dc266e6e99e83',
  'lastChanged': '2023-08-17T06:30:08.286Z',
  'lastSeen': '2023-09-03T23:33:48.894Z',
  'method': 'GET',
  'path': '/health-check',
  'protectionStatus': 'monitored',
  'riskFactors': {'Attack complexity: low': {},
                  'Attack vector: network': {},
                  'Critical severity': {},
                  'DoS - High': {},
                  'DoS - Low': {},
                  'Exploit exists - POC': {},
                  'Has fix': {},
                  'High severity': {},
                  'Medium severity': {},
                  'Recent vulnerability': {},
                  'Remote execution': {}},
  'riskScore': 11,
  'ruleID': 'vuln-host',
  'servers': ['http://10.8.0.9:8080', 'http://10.12.1.6:8080'],
  'vulnerabilityDistribution': {'critical': 6,
                                'high': 22,
                                'low': 2,
                                'medium': 8,
                                'total': 38}}]
```